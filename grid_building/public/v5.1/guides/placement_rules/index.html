<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Placement Rules | GridBuilding Plugin</title>
<meta name=description content="Placement Rules documentation for the Grid Building system"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><link rel=stylesheet href=/css/custom.css><meta name=generator content="Hugo 0.146.5"></head><body><div class=gb-layout><header class=gb-header><a href=/ class=gb-brand><i class="fas fa-cubes" style=color:var(--gb-primary)></i>
<span>GridBuilding Plugin</span></a><div class=gb-search><i class="fas fa-search"></i>
<input type=text placeholder="Search documentation..." aria-label=Search></div><nav class=gb-nav><a href=/ class=gb-nav-link>Home
</a><a href=/v5.1/overview/ class=gb-nav-link>Documentation
</a><a href=/v5.1/overview/ class=gb-nav-link>Grid Building Plugin Overview
</a><a href=/v5.1/api/ class=gb-nav-link>API Reference
</a><a href=/v5.1/guides/ class=gb-nav-link>Getting Started Guides
</a><a href=/v5.1/examples/ class=gb-nav-link>Examples
</a><a href=/v5.1/examples/ class=gb-nav-link>Code Examples
</a><a href=/community/ class=gb-nav-link>Community</a></nav></header><aside class=gb-sidebar><nav class=gb-sidebar-nav><div class=gb-sidebar-section><div class=gb-sidebar-title>GridBuilding Plugin</div><a href=/gridbuilding/getting_started/ class=gb-sidebar-link>Getting Started with GridBuilding
</a><a href=/gridbuilding/csharp_state_integration/ class=gb-sidebar-link>C# State Integration with Godot Frontend
</a><a href=/gridbuilding/api_reference/ class=gb-sidebar-link>API Reference
</a><a href=/gridbuilding/troubleshooting/ class=gb-sidebar-link>Troubleshooting Guide
</a><a href=/gridbuilding/godot_integration_example/ class=gb-sidebar-link>Godot Integration Example
</a><a href=/gridbuilding/service_based_architecture/ class=gb-sidebar-link>Service-Based Architecture</a></div><div class=gb-sidebar-section><div class=gb-sidebar-title>Grid Building Plugin v5.1.0</div><a href=/v5.1/overview/ class=gb-sidebar-link>Grid Building Plugin Overview
</a><a href=/v5.1/guides/ class=gb-sidebar-link>Getting Started Guides
</a><a href=/v5.1/api/ class=gb-sidebar-link>C# API Reference
</a><a href=/v5.1/examples/ class=gb-sidebar-link>Code Examples
</a><a href=/v5.1/debugging/ class=gb-sidebar-link>Debug Tools
</a><a href=/v5.1/migration/ class=gb-sidebar-link>Migration Guide
</a><a href=/v5.1/testing/ class=gb-sidebar-link>Testing
</a><a href=/v5.1/validation/ class=gb-sidebar-link>Validation Tools</a></div><div class=gb-sidebar-section><div class=gb-sidebar-title>Grid Building Plugin v5.0.0</div><a href=/v5.0/api/ class=gb-sidebar-link>GDScript API Reference
</a><a href=/v5.0/debugging/ class=gb-sidebar-link>Debug Tools
</a><a href=/v5.0/overview/ class=gb-sidebar-link>Grid Building Plugin v5.0.0
</a><a href=/v5.0/migration/ class=gb-sidebar-link>Migration Guide
</a><a href=/v5.0/guides/ class=gb-sidebar-link>Plugin Overview
</a><a href=/v5.0/testing/ class=gb-sidebar-link>Testing
</a><a href=/v5.0/validation/ class=gb-sidebar-link>Validation Tools</a></div></nav></aside><main class=gb-main><div class=gb-content><h1>Placement Rules</h1><hr><p>This page documents the placement rule classes and validation system in Grid Building v5.0.0.</p><h2 id=core-concepts>Core Concepts</h2><h1 id=placement-rules-system>Placement Rules System</h1><p>The placement rules system provides <strong>extensible validation logic</strong> for determining where objects can be placed. This is a <strong>core entry point</strong> for customizing building behavior.</p><h2 id=-key-entry-points>üéØ Key Entry Points</h2><p><strong>Base Classes (extend these):</strong></p><ul><li><strong><a href=../api/PlacementRule/>PlacementRule</a></strong> - Base class for all validation</li><li><strong><a href=../api/TileCheckRule/>TileCheckRule</a></strong> - Spatial/per-tile validation</li></ul><p><strong>Common Rule Classes (use these):</strong></p><ul><li><strong><a href=../api/CollisionsCheckRule/>CollisionsCheckRule</a></strong> - Physics collision validation</li><li><strong><a href=../api/WithinTilemapBoundsRule/>WithinTilemapBoundsRule</a></strong> - Tilemap boundary validation</li><li><strong><a href=../api/ValidPlacementTileRule/>ValidPlacementTileRule</a></strong> - Custom tile validation</li></ul><ol><li><code>setup(params: RuleValidationParameters) -> Array[String]</code> ‚Äî validate context & capture references.</li><li><code>validate_placement() -> RuleResult</code> ‚Äî compute pass/fail (and message).</li><li><code>apply() -> bool</code> (optional) ‚Äî run only after <em>all</em> rules pass (e.g. spend inventory materials).</li><li><code>tear_down()</code> ‚Äî cleanup when preview target changes or build mode exits.</li></ol><p>Each <a href=../api/RuleResult/>RuleResult</a> couples: the rule instance, <code>is_successful: bool</code>, and a human‚Äëreadable message.</p><p>Rules that operate on per‚Äëtile indicators usually extend <a href=../api/TileCheckRule/>TileCheckRule</a>, which adds:</p><ul><li><code>indicators : Array[RuleCheckIndicator]</code> (shape casts / tile probes)</li><li><code>visual_priority</code> & <code>fail_visual_settings</code> for indicator coloring precedence.</li></ul><p><a href=../api/RuleFilters/>RuleFilters</a>.only_tile_check(rules) helps extract all <a href=../api/TileCheckRule/>TileCheckRule</a> instances from a mixed array.</p><h2 id=major-enhancements-in-v500>Major Enhancements in v5.0.0</h2><h3 id=-architectural-improvements>üèóÔ∏è <strong>Architectural Improvements</strong></h3><ul><li><strong>Enhanced RuleResult Structure</strong>: More detailed validation reporting with better error messages</li><li><strong>Improved Diagnostics</strong>: Better logging and debugging support for rule execution</li><li><strong>Performance Optimizations</strong>: Reduced allocations and faster validation cycles
{/* Supports 4.5 as well. Minimum 4.4+. */}</li></ul><h3 id=-validation-enhancements>üîß <strong>Validation Enhancements</strong></h3><ul><li><strong>Detailed Error Messages</strong>: All rules now provide more specific failure reasons</li><li><strong>Better Rule Execution Tracing</strong>: Enhanced debugging capabilities for rule validation</li><li><strong>Improved Visual Priority</strong>: More sophisticated indicator coloring precedence</li><li><strong>Enhanced Collision Detection</strong>: Better physics collision handling and reporting</li></ul><h3 id=-migration-from-v431>üìä <strong>Migration from v4.3.1</strong></h3><ul><li><strong>Automatic Compatibility</strong>: Legacy rule implementations continue to work</li><li><strong>Enhanced Error Reporting</strong>: Gradual migration path to detailed error messages
{/* Removed internal testing class reference */}</li></ul><h2 id=shipped-rule-classes>Shipped Rule Classes</h2><table><thead><tr><th>Class</th><th>File</th><th>Purpose</th><th>Notes</th></tr></thead><tbody><tr><td><a href=../api/PlacementRule/>PlacementRule</a></td><td><code>placement_rules/placement_rule.gd</code></td><td>Base contract (setup / validate / apply / tear_down).</td><td>Do not implement placement logic here directly.</td></tr><tr><td><a href=../api/TileCheckRule/>TileCheckRule</a></td><td><code>placement_rules/tile_check_rule.gd</code></td><td>Base for indicator / per‚Äëtile spatial checks.</td><td>Supplies <code>indicators</code> list & visual metadata.</td></tr><tr><td><a href=../api/CollisionsCheckRule/>CollisionsCheckRule</a></td><td><code>placement_rules/template_rules/collisions_check_rule.gd</code></td><td>Verifies presence or absence of physics overlaps per indicator.</td><td>Supports <code>pass_on_collision</code>, custom messages, layer listing, and exceptions for preview bodies.</td></tr><tr><td><a href=../api/WithinTilemapBoundsRule/>WithinTilemapBoundsRule</a></td><td><code>placement_rules/template_rules/within_tilemap_bounds_rule.gd</code></td><td>Ensures each indicator rests over a used tile in the target <code>TileMapLayer</code>.</td><td>Returns success if there are zero indicators (nothing to validate).</td></tr><tr><td><a href=../api/ValidPlacementTileRule/>ValidPlacementTileRule</a></td><td><code>placement_rules/template_rules/valid_placement_tile_rule.gd</code></td><td>(See file for exact logic) Validates indicator tiles against a tile validity condition.</td><td>Per‚Äëtile <a href=../api/TileCheckRule/>TileCheckRule</a> variant.</td></tr><tr><td><a href=../api/SpendMaterialsRuleGeneric/>SpendMaterialsRuleGeneric</a></td><td><code>placement_rules/template_rules/spend_materials_rule_generic.gd</code></td><td>Generic resource‚Äëspend gate (base for inventory integration).</td><td>Abstracted material spending.</td></tr><tr><td><code>SpendMaterialsRule</code></td><td><code>grid_building_inventory/rules/spend_materials_rule.gd</code></td><td>Consumes items from an <code>ItemContainer</code> (inventory addon) once placement is confirmed.</td><td>Builds a failure list of missing resources; <code>apply()</code> spends them.</td></tr><tr><td><a href=../api/RuleCheckIndicator/>RuleCheckIndicator</a></td><td><code>placement/rule_check_indicator/rule_check_indicator.gd</code></td><td>(Support resource) Provides shape / tile position & validation for rules.</td><td>Not a rule itself but central to tile checks.</td></tr></tbody></table><blockquote><p>Only classes present in the repository are listed. No speculative or future rule names are included.</p></blockquote><h2 id=validation-flow-simplified>Validation Flow (Simplified)</h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>1. Indicators prepared &amp; attached (via Indicator / Placement setup).
</span></span><span style=display:flex><span>2. For each rule in configured order:
</span></span><span style=display:flex><span>  rule.setup(params)  (once per preview change)
</span></span><span style=display:flex><span>  result := rule.validate_placement()
</span></span><span style=display:flex><span>  aggregate failure state &amp; collect messages
</span></span><span style=display:flex><span>3. If all results successful:
</span></span><span style=display:flex><span>  for each rule: rule.apply() (side‚Äëeffects like spending materials)
</span></span><span style=display:flex><span>4. On preview change / exit:
</span></span><span style=display:flex><span>  rule.tear_down()
</span></span></code></pre></td></tr></table></div></div><p>There is no global fatal short‚Äëcircuit flag built into the base class; each pipeline step decides whether to continue based on aggregated success.</p><h2 id=key-behaviors-by-rule>Key Behaviors by Rule</h2><h3 id=collisionscheckrule>CollisionsCheckRule</h3><ul><li>Toggles behavior with <code>pass_on_collision</code> (expect overlap vs expect empty space).</li><li>Temporarily overrides each indicator&rsquo;s <code>collision_mask</code> then restores it.</li><li>Adds preview bodies as exceptions so a building never collides with itself.</li><li>Reports counts (passed / failed / collision occurrences) at verbose log level.</li></ul><h3 id=withintilemapboundsrule>WithinTilemapBoundsRule</h3><ul><li>Converts each indicator global position to tile coordinates on the target <code>TileMapLayer</code>.</li><li>Success requires a valid tile (tile data present) for every indicator.</li><li>Gracefully handles null / freed indicators with warnings (cleaned elsewhere).</li></ul><h3 id=validplacementtilerule>ValidPlacementTileRule</h3><ul><li>Performs a tile validity test (consult file for exact assertion logic).</li><li>Supplies messages for success/failure similar to the bounds rule.</li></ul><h3 id=spendmaterialsrule-inventory-addon>SpendMaterialsRule (Inventory Addon)</h3><ul><li>Searches for an <code>ItemContainer</code> on the placer (or its children) that can hold all required item types.</li><li><code>validate_placement()</code> builds a missing item list; failure message enumerates deficits.</li><li><code>apply()</code> removes counted items (ensuring atomic resource deduction post‚Äësuccess).</li></ul><h3 id=spendmaterialsrulegeneric>SpendMaterialsRuleGeneric</h3><ul><li>Underlying generic implementation invoked by specialized spend rules; provides shared messages / logic.</li></ul><h2 id=implementing-a-custom-rule>Implementing a Custom Rule</h2><ol><li>Extend <a href=../api/PlacementRule/>PlacementRule</a> or <a href=../api/TileCheckRule/>TileCheckRule</a>.</li><li>Export any configuration properties (messages, thresholds, masks).</li><li>In <code>setup(params)</code> call <code>super.setup(params)</code> first; return collected issue strings.</li><li>In <code>validate_placement()</code> guard with <code>if not guard_ready():</code> for robustness.</li><li>Return a <a href=../api/RuleResult/>RuleResult</a> (never <code>null</code>). Keep messages concise & player‚Äëoriented.</li><li>If you need side‚Äëeffects only on successful placement, override <code>apply()</code>.</li><li>Add the rule resource to your placement rule list (project settings, config resource, or placeable‚Äëspecific rule array).</li></ol><h2 id=indicator-visual-priority>Indicator Visual Priority</h2><p>When multiple <a href=../api/TileCheckRule/>TileCheckRule</a> instances fail for the same tile, indicator appearance is selected by the failing rule with the highest <code>visual_priority</code> that provides <code>fail_visual_settings</code>. This centralizes which failure reason drives tile coloring.</p><h2 id=logging--diagnostics>Logging & Diagnostics</h2><p>Rules use the shared logger from <code>RuleValidationParameters</code>:</p><ul><li>Warnings for null / invalid indicators (should be rare; indicates cleanup race).</li><li>Verbose summaries including pass/fail counts (<a href=../api/CollisionsCheckRule/>CollisionsCheckRule</a>, <a href=../api/WithinTilemapBoundsRule/>WithinTilemapBoundsRule</a>).</li></ul><p>Use these logs to confirm rule ordering and detect misconfigured masks or missing containers.</p><h2 id=inventory-integration-spendmaterialsrule>Inventory Integration (SpendMaterialsRule)</h2><p>To enable resource spending:</p><ol><li>Add the Inventory addon (<code>addons/grid_building_inventory/</code>).</li><li>Create a <code>SpendMaterialsRule</code> resource and set <code>materials_to_spend</code> (array of <code>BaseItemStack</code>).</li><li>Ensure the placer (typically the player / controller node) or a child has an <code>ItemContainer</code> that <code>does_it_allow()</code> every item type required.</li><li>Add the rule to the active rule set. On successful placement, items are automatically deducted in <code>apply()</code>.</li></ol><h2 id=cross-references>Cross References</h2><ul><li><a href=/v5-0/guides/collision_mapping/>Collision Mapping</a>: Collision detection and mapping system</li><li><a href=/v5-0/guides/indicator_setup_report/>Indicator Setup Report</a>: Indicator configuration diagnostics</li><li><a href=/v5-0/guides/isometric-implementation/>Isometric Implementation</a>: Implementing Grid Building in isometric games (shapes, rotation, collision)</li><li><a href=/v5-0/guides/building_system_process/>Building System Process</a>: Complete building system workflow</li><li><a href=/v5-0/guides/dependency_injection/>Dependency Injection</a>: Dependency injection patterns</li></ul><hr><p>Support / Purchase Hub: <strong><a href=https://linktr.ee/gridbuilder>Linktree ‚Äì All Grid Builder Links</a></strong></p></div></main><aside class=gb-toc><div class=gb-toc-title>On this page</div><nav id=TableOfContents><ul><li><a href=#core-concepts>Core Concepts</a></li></ul><ul><li><a href=#-key-entry-points>üéØ Key Entry Points</a></li><li><a href=#major-enhancements-in-v500>Major Enhancements in v5.0.0</a><ul><li><a href=#-architectural-improvements>üèóÔ∏è <strong>Architectural Improvements</strong></a></li><li><a href=#-validation-enhancements>üîß <strong>Validation Enhancements</strong></a></li><li><a href=#-migration-from-v431>üìä <strong>Migration from v4.3.1</strong></a></li></ul></li><li><a href=#shipped-rule-classes>Shipped Rule Classes</a></li><li><a href=#validation-flow-simplified>Validation Flow (Simplified)</a></li><li><a href=#key-behaviors-by-rule>Key Behaviors by Rule</a><ul><li><a href=#collisionscheckrule>CollisionsCheckRule</a></li><li><a href=#withintilemapboundsrule>WithinTilemapBoundsRule</a></li><li><a href=#validplacementtilerule>ValidPlacementTileRule</a></li><li><a href=#spendmaterialsrule-inventory-addon>SpendMaterialsRule (Inventory Addon)</a></li><li><a href=#spendmaterialsrulegeneric>SpendMaterialsRuleGeneric</a></li></ul></li><li><a href=#implementing-a-custom-rule>Implementing a Custom Rule</a></li><li><a href=#indicator-visual-priority>Indicator Visual Priority</a></li><li><a href=#logging--diagnostics>Logging & Diagnostics</a></li><li><a href=#inventory-integration-spendmaterialsrule>Inventory Integration (SpendMaterialsRule)</a></li><li><a href=#cross-references>Cross References</a></li></ul></nav></aside><footer class=gb-footer><p>&copy; 2025 Chris Tutorials. All rights reserved.</p><p>Built with <a href=https://gohugo.io/ target=_blank>Hugo</a> and
<a href=https://godotengine.org/ target=_blank>Godot</a>.</p></footer></div></body></html>