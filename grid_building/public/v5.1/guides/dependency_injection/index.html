<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Dependency Injection System | GridBuilding Plugin</title>
<meta name=description content="Dependency Injection System documentation for the Grid Building system"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><link rel=stylesheet href=/css/custom.css><meta name=generator content="Hugo 0.146.5"></head><body><div class=gb-layout><header class=gb-header><a href=/ class=gb-brand><i class="fas fa-cubes" style=color:var(--gb-primary)></i>
<span>GridBuilding Plugin</span></a><div class=gb-search><i class="fas fa-search"></i>
<input type=text placeholder="Search documentation..." aria-label=Search></div><nav class=gb-nav><a href=/ class=gb-nav-link>Home
</a><a href=/v6.0/overview/ class=gb-nav-link>Documentation
</a><a href=/v5.1/overview/ class=gb-nav-link>Grid Building Plugin Overview
</a><a href=/v6.0/api/ class=gb-nav-link>API Reference
</a><a href=/v5.1/guides/ class=gb-nav-link>Getting Started Guides
</a><a href=/v6.0/examples/ class=gb-nav-link>Examples
</a><a href=/v5.1/examples/ class=gb-nav-link>Code Examples
</a><a href=/community/ class=gb-nav-link>Community
</a><a href=/v5.1/architecture-diagrams/ class=gb-nav-link>Architecture Diagrams</a></nav></header><aside class=gb-sidebar><nav class=gb-sidebar-nav><div class=gb-sidebar-section><div class=gb-sidebar-title>V6.0s</div><a href=/v6.0/guides/6-0-readiness-status/ class=gb-sidebar-link>GridBuilding 6.0 Readiness Status
</a><a href=/v6.0/guides/getting_started/ class=gb-sidebar-link>Getting Started with GridBuilding
</a><a href=/v6.0/guides/mode-architecture/ class=gb-sidebar-link>GridBuilding 6.0 Mode Architecture
</a><a href=/v6.0/guides/gdscript-to-csharp-mapping/ class=gb-sidebar-link>GDScript to C# Migration Guide
</a><a href=/v6.0/guides/csharp_state_integration/ class=gb-sidebar-link>C# State Integration with Godot Frontend
</a><a href=/v6.0/guides/troubleshooting/ class=gb-sidebar-link>Troubleshooting Guide
</a><a href=/v6.0/examples/godot_integration_example/ class=gb-sidebar-link>Godot Integration Example
</a><a href=/gridbuilding/v6.0-public/guides/dependency-resolution/ class=gb-sidebar-link>Dependency Resolution in GridBuilding v6.0 (Godot)
</a><a href=/gridbuilding/v6.0-public/guides/userid-quickstart/ class=gb-sidebar-link>Quick Start: Game-Owned UserId & Multi-Owner Orchestrators
</a><a href=/gridbuilding/v6.0-public/guides/building-system-architecture/ class=gb-sidebar-link>BuildingSystem Architecture (Legacy Session Orchestrator)
</a><a href=/gridbuilding/v6.0-public/guides/multi-owner-orchestration-priorities/ class=gb-sidebar-link>Multi-Owner Orchestration Priorities (v6.0)
</a><a href=/gridbuilding/v6.0/guides/placement-system-architecture/ class=gb-sidebar-link>Placement System and Architecture in GridBuilding v6.0 (Godot)
</a><a href=/gridbuilding/v6.0-public/guides/manipulation-system-architecture/ class=gb-sidebar-link>ManipulationSystemNode Architecture (Session Orchestrator)
</a><a href=/v6.0/guides/service_based_architecture/ class=gb-sidebar-link>Service-Based Architecture
</a><a href=/gridbuilding/v6-0/api/ class=gb-sidebar-link>GridBuilding API Reference</a></div><div class=gb-sidebar-section><div class=gb-sidebar-title>Grid Building Plugin v5.1.0</div><a href=/v5.1/overview/ class=gb-sidebar-link>Grid Building Plugin Overview
</a><a href=/v5.1/guides/ class=gb-sidebar-link>Getting Started Guides
</a><a href=/v5.1/api/ class=gb-sidebar-link>C# API Reference
</a><a href=/v5.1/examples/ class=gb-sidebar-link>Code Examples
</a><a href=/v5.1/architecture-diagrams/ class=gb-sidebar-link>Architecture Diagrams
</a><a href=/v5.1/debugging/ class=gb-sidebar-link>Debug Tools
</a><a href=/v5.1/migration/ class=gb-sidebar-link>Migration Guide
</a><a href=/v5.1/testing/ class=gb-sidebar-link>Testing
</a><a href=/v5.1/validation/ class=gb-sidebar-link>Validation Tools</a></div><div class=gb-sidebar-section><div class=gb-sidebar-title>Grid Building Plugin v5.0.0</div><a href=/v5.0/api/ class=gb-sidebar-link>GDScript API Reference
</a><a href=/v5.0/overview/ class=gb-sidebar-link></a><a href=/v5.0/debugging/ class=gb-sidebar-link>Debug Tools
</a><a href=/v5.0/migration/ class=gb-sidebar-link>Migration Guide
</a><a href=/v5.0/guides/ class=gb-sidebar-link>Plugin Overview
</a><a href=/v5.0/testing/ class=gb-sidebar-link>Testing
</a><a href=/v5.0/validation/ class=gb-sidebar-link>Validation Tools</a></div></nav></aside><main class=gb-main><div class=gb-content><h1>Dependency Injection System</h1><hr><p>The plugin includes a lightweight, opt‑in dependency injection (DI) mechanism that removes most manual wiring between gameplay nodes and the Grid Building systems. It centers around two core pieces:</p><ol><li><a href=../api/GBCompositionContainer/>GBCompositionContainer</a> – A per-context (e.g., per player / world / session) resource that owns configured settings, templates, actions, states, contexts, and logging.</li><li><a href=../api/GBInjectorSystem/>GBInjectorSystem</a> – A scene system that discovers nodes needing dependencies and injects the shared <a href=../api/GBCompositionContainer/>GBCompositionContainer</a> into them at runtime. <strong>Automatically validates configuration after injection completion.</strong></li></ol><hr><h2 id=automatic-validation>Automatic Validation</h2><p><strong>GBInjectorSystem now handles validation automatically</strong> - no manual validation calls required!</p><p>After dependency injection completes, the system automatically:</p><ol><li><strong>Validates configuration</strong> using the composition container&rsquo;s validation methods</li><li><strong>Logs any issues</strong> found during validation using the centralized GBLogger system</li><li><strong>Provides feedback</strong> to developers if setup is incomplete</li><li><strong>Prevents silent failures</strong> with comprehensive runtime issue detection</li></ol><h3 id=before-manual-validation-required>Before (Manual Validation Required)</h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>_ready</span>() <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72>void</span>: 
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># Set up Grid Building systems...</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># GBInjectorSystem handles validation automatically ✅</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># No manual validation calls needed!</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=after-automatic-validation>After (Automatic Validation)</h3><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>_ready</span>() <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72>void</span>: 
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># Set up Grid Building systems...</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># That&#39;s it! GBInjectorSystem automatically:</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># 1. Injects dependencies via resolve_gb_dependencies()</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># 2. Validates all components immediately after injection</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># 3. Logs any issues to the console with helpful context</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=benefits>Benefits</h3><ul><li><strong>Zero-Configuration Validation</strong>: No manual validation calls needed</li><li><strong>Error Prevention</strong>: Impossible to forget validation - it happens automatically</li><li><strong>Consistent Behavior</strong>: All Grid Building setups validate the same way</li><li><strong>Immediate Feedback</strong>: Validation happens right after injection with full context</li><li><strong>Cleaner Code</strong>: No validation boilerplate cluttering your <code>_ready()</code> methods</li></ul><h3 id=automatic-validation-system>Automatic Validation System</h3><p>The system validates all dependencies <strong>immediately after injection</strong>:</p><p><strong>What Gets Validated:</strong></p><ul><li>Configuration structure and resources exist</li><li>Required templates and settings are present</li><li>Game-specific dependencies (GBLevelContext, GBUser / GBOwner) are available</li><li>System interconnections are properly wired</li><li>Component contracts are satisfied</li></ul><p><strong>When Validation Happens:</strong></p><ul><li><strong>Automatically</strong> when GBInjectorSystem completes dependency injection</li><li><strong>No manual calls required</strong> - validation is built into the injection process</li><li><strong>Immediate error detection</strong> - issues are caught right after injection with full context</li></ul><p><strong>How It Works:</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#8b949e;font-style:italic># GBInjectorSystem automatically calls this on all nodes:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>resolve_gb_dependencies</span>(container: GBCompositionContainer) <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72>void</span>:
</span></span><span style=display:flex><span>    _building_system <span style=color:#ff7b72;font-weight:700>=</span> container<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_building_system</span>()
</span></span><span style=display:flex><span>    _logger <span style=color:#ff7b72;font-weight:700>=</span> container<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_logger</span>()
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># After injection, GBInjectorSystem automatically validates this component</span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># by calling get_runtime_issues() and logging any problems</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># You can still implement this for custom validation:</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>get_runtime_issues</span>() <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#f0883e;font-weight:700>Array</span>[<span style=color:#f0883e;font-weight:700>String</span>]:
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>var</span> issues: <span style=color:#f0883e;font-weight:700>Array</span>[<span style=color:#f0883e;font-weight:700>String</span>] <span style=color:#ff7b72;font-weight:700>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>if</span> _building_system <span style=color:#ff7b72;font-weight:700>==</span> <span style=color:#ff7b72>null</span>:
</span></span><span style=display:flex><span>        issues<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>append</span>(<span style=color:#a5d6ff>&#34;Building system not injected&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>return</span> issues  <span style=color:#8b949e;font-style:italic># GBInjectorSystem will log these automatically</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=goals>Goals</h2><ul><li>Centralize access to configuration, states, and contexts.</li><li>Avoid deep node path lookups or duplicate singletons.</li><li>Allow multiple independent grid building contexts to coexist (e.g., splitscreen players) by scoping injection roots.</li><li>Support late / dynamic node creation without extra boilerplate.</li><li>Provide consistent logging and validation gateways.</li><li><strong>Automatically validate configuration after dependency injection</strong>, eliminating manual setup errors.</li></ul><hr><h2 id=optin-contract>Opt‑In Contract</h2><p>Any node that implements:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>resolve_gb_dependencies</span>(p_config: GBCompositionContainer) <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72>void</span>:
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic># Pull what you need from p_config</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>var</span> logger <span style=color:#ff7b72;font-weight:700>:=</span> p_config<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_logger</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>var</span> targeting_state <span style=color:#ff7b72;font-weight:700>:=</span> p_config<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_targeting_state</span>()
</span></span></code></pre></td></tr></table></div></div><p>…will automatically receive the active composition container when it enters an injection scope.</p><p>No interface registration is required—presence of the method name <code>resolve_gb_dependencies</code> is the marker.</p><hr><h2 id=gbcompositioncontainer-overview>GBCompositionContainer Overview</h2><p><a href=../api/GBCompositionContainer/>GBCompositionContainer</a> is the authoritative gateway to all major systems:</p><ul><li>Settings (<code>get_settings()</code>, <code>get_visual_settings()</code>, <code>get_manipulation_settings()</code>, <code>get_actions()</code>, <code>get_messages()</code>).</li><li>Templates (<code>get_templates()</code>).</li><li>Contexts (<code>get_contexts()</code>) and sub-context accessors like <code>get_systems_context()</code> or <code>get_indicator_context()</code>.</li><li>Mutable runtime state holders (<code>get_states()</code> returning building / targeting / manipulation / mode states).</li><li>Logging (<code>get_logger()</code>) – with graceful fallback when configuration is incomplete.</li><li>Validation (<code>get_runtime_issues()</code>) - automatically called by GBInjectorSystem after dependency injection.</li></ul><p>It lazy‑constructs internal components so that missing or partially configured resources can still emit structured warnings via the logger.</p><h3 id=why-a-resource>Why a Resource?</h3><p>Being a <code>Resource</code> allows cloning or per‑player instancing while keeping memory light and avoiding tight coupling to any scene tree node. It also simplifies tooling and export workflows.</p><h3 id=central-configuration-gbconfig>Central Configuration: GBConfig</h3><p><a href=../api/GBConfig/>GBConfig</a> is the single authoritative configuration resource consumed by <a href=../api/GBCompositionContainer/>GBCompositionContainer</a>. It aggregates previously scattered exported fields (grid sizing, placement & validation toggles, indicator visuals, manipulation tuning, action/message resources, debug flags) into one asset.</p><p>Key aspects:</p><ul><li>Acts as the root object passed into composition; other sub-resources (settings, templates, messages) are referenced from it.</li><li>Enables cloning per player/session by duplicating a single resource tree.</li><li>Reduces risk of version skew (all tuning lives together, easier diff/merge in VCS).</li><li>Validation runs against <a href=../api/GBConfig/>GBConfig</a> via <a href=../api/GBConfigurationValidator/>GBConfigurationValidator</a> before/after injection.</li><li>Eliminates brittle node export wiring; systems retrieve needed values through container accessors which delegate to <a href=../api/GBConfig/>GBConfig</a>.</li></ul><p>Minimal setup workflow:</p><ol><li>Create a <a href=../api/GBConfig/>GBConfig</a> resource (e.g., <code>res://config/grid_building_config.tres</code>).</li><li>Populate its sub-sections (grid settings, visual settings, manipulation, actions/messages, templates references).</li><li>Assign the resource to a <a href=../api/GBCompositionContainer/>GBCompositionContainer</a> (inspector or factory method).</li><li>Provide that container to <a href=../api/GBInjectorSystem/>GBInjectorSystem</a>.</li></ol><p>Benefits vs scattered exports:</p><table><thead><tr><th>Previous Pattern (4.x)</th><th>Centralized in 5.0.0 (<a href=../api/GBConfig/>GBConfig</a>)</th><th>Outcome</th></tr></thead><tbody><tr><td>Dozens of per-system exported tuning fields</td><td>Single resource with structured sections</td><td>Faster onboarding & consistent defaults</td></tr><tr><td>Hard to validate completeness</td><td>Validator can traverse one tree</td><td>Early warning & logging</td></tr><tr><td>Duplicate tweaks across multiple scenes</td><td>Reuse one shared asset</td><td>Lower maintenance cost</td></tr></tbody></table><p>See the API: <a href=../api/GBConfig/>GBConfig</a> and <a href=../api/GBConfigurationValidator/>GBConfigurationValidator</a> for field-level detail.</p><hr><h2 id=gbinjectorsystem-lifecycle>GBInjectorSystem Lifecycle</h2><ol><li>Initialization (<code>_ready</code> → <code>_initialize</code>):<ul><li>Verifies a <code>composition_container</code> is assigned; otherwise disables itself (push_error).</li><li>Captures debug settings from the container (<code>_debug</code>).</li><li>Performs an initial recursive injection over each configured injection root (or the scene tree root if none).</li><li>Emits <code>initial_injection_completed</code> after the first pass.</li></ul></li><li>Runtime Monitoring:<ul><li>Connects to <code>SceneTree.node_added</code> to intercept dynamically added nodes.</li><li>Connects <code>child_entered_tree</code> per injection root to scope additions.</li><li>Connects <code>tree_exiting</code> per injected node for cleanup / meta removal and optional verbose exit logging.</li></ul></li><li>Injection Execution (<code>inject_node</code>):<ul><li>Skips nodes not yet inside the tree or already injected by this injector instance.</li><li>If the node exposes <code>resolve_gb_dependencies</code>, calls it with the shared <code>composition_container</code>.</li><li>Attaches metadata (<code>gb_injection_meta</code>) with injector id, weakref, timestamp, and stored signal callbacks.</li><li>Emits <code>node_injected</code> and logs a verbose message (if logging level allows).</li></ul></li><li>Validation:<ul><li><code>validate_and_log_issues()</code> defers to the container’s validation methods, reporting warnings through the logger.</li></ul></li></ol><hr><h2 id=injection-scoping>Injection Scoping</h2><p>Specify one or more <code>injection_roots</code> on the <a href=../api/GBInjectorSystem/>GBInjectorSystem</a> to restrict which subtrees participate. If left empty, the entire scene tree root is used.</p><p>Scope check logic:</p><ul><li>A newly added node is injected only if it is (or is a descendant of) one of the root nodes.</li><li>Multiple roots can coexist; each is monitored independently.</li></ul><p>This enables patterns like separate player worlds sharing the same code paths but isolated state.</p><hr><h2 id=metadata--idempotency>Metadata & Idempotency</h2><p>A node stores <code>gb_injection_meta</code> after successful injection. Subsequent passes (e.g., from other signal hooks) short‑circuit if the stored injector id matches, preventing duplicate dependency assignments or log spam.</p><p>Metadata fields (representative):</p><ul><li><code>injector_ref</code>: Weak reference to the injector.</li><li><code>injector_id</code>: Numeric instance id snapshot.</li><li><code>timestamp_ms</code>: Time of injection for debugging.</li><li>Internal keys for connected callbacks (<code>_child_entered_cb</code>, <code>_tree_exiting_cb</code>).</li></ul><p>On node exit, callbacks are disconnected and metadata removed (or trimmed) to avoid memory / reference leaks.</p><hr><h2 id=logging--debug-levels>Logging & Debug Levels</h2><p>The injector defers most formatting to <a href=../api/GBLogger/>GBLogger</a> retrieved from the container. Verbose per-node lines (e.g., <code>[GBInjectorSystem] Injected: NodeName at /root/...</code>) appear only when the debug level threshold permits. Exit events optionally log a one‑time debug line via <code>log_debug_once</code> to reduce noise.</p><p>If logger acquisition fails early, the injector falls back to standard printing until the container can provide a logger.</p><hr><h2 id=validation-flow>Validation Flow</h2><p>Typical startup order:</p><ol><li>Create or assign a <a href=../api/GBCompositionContainer/>GBCompositionContainer</a> (or its 5.1 session alias <code>GBSession</code>) with at least a <a href=../api/GBConfig/>GBConfig</a> resource.</li><li>Add a <a href=../api/GBInjectorSystem/>GBInjectorSystem</a> node, set its <code>composition_container</code>, optionally define <code>injection_roots</code>.</li><li>Let <code>_ready()</code> trigger initial injection; nodes with <code>resolve_gb_dependencies</code> now have access to configuration.<ul><li><strong>Editor validation runs automatically</strong> during injector <code>_ready()</code></li></ul></li><li>After game dependencies are ready (GBLevelContext, GBUser / GBOwner), call <code>run_validation()</code> on the injector to trigger runtime validation and log any issues.</li></ol><p><strong>Manual Runtime Validation:</strong></p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Option 1: Use injector helper (validates + logs)</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> is_valid <span style=color:#ff7b72;font-weight:700>:=</span> injector_system<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>run_validation</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Option 2: Get issues directly without logging</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> issues <span style=color:#ff7b72;font-weight:700>:=</span> composition_container<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_runtime_issues</span>()
</span></span><span style=display:flex><span><span style=color:#ff7b72>if</span> <span style=color:#ff7b72;font-weight:700>not</span> issues<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>is_empty</span>():
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>for</span> issue <span style=color:#ff7b72;font-weight:700>in</span> issues:
</span></span><span style=display:flex><span>        push_error(issue)
</span></span></code></pre></td></tr></table></div></div><p>Runtime validations can re-run after loading level scenes to surface dynamic setup issues.</p><hr><h2 id=example-pattern>Example Pattern</h2><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#8b949e;font-style:italic># In a scene script needing grid building systems</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>extends</span> <span style=color:#f0883e;font-weight:700>Node</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> _logger : GBLogger
</span></span><span style=display:flex><span><span style=color:#ff7b72>var</span> _targeting_state : GridTargetingState
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>resolve_gb_dependencies</span>(p_config: GBCompositionContainer) <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72>void</span>:
</span></span><span style=display:flex><span>    _logger <span style=color:#ff7b72;font-weight:700>=</span> p_config<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_logger</span>()
</span></span><span style=display:flex><span>    _targeting_state <span style=color:#ff7b72;font-weight:700>=</span> p_config<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_targeting_state</span>()
</span></span><span style=display:flex><span>    _logger<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>log_debug</span>( <span style=color:#a5d6ff>&#34;Dependencies resolved for </span><span style=color:#a5d6ff>%s</span><span style=color:#a5d6ff>&#34;</span> <span style=color:#ff7b72;font-weight:700>%</span> name)
</span></span></code></pre></td></tr></table></div></div><h3 id=user--session-example-51-bridge>User & Session example (5.1 bridge)</h3><p>The 5.1 GDScript bridge exposes <code>GBSession</code> (alias for <code>GBCompositionContainer</code>) and <code>GBUser</code> (alias for <code>GBOwner</code>) so you can use the same terminology as the 6.0 user/session model:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#ff7b72>extends</span> <span style=color:#f0883e;font-weight:700>Node</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@export</span> <span style=color:#ff7b72>var</span> composition_container: GBSession
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@export</span> <span style=color:#ff7b72>var</span> user: GBUser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>func</span> <span style=color:#d2a8ff;font-weight:700>resolve_gb_dependencies</span>(p_container: GBCompositionContainer) <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72>void</span>:
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic># Use the injected container as the active session</span>
</span></span><span style=display:flex><span>	composition_container <span style=color:#ff7b72;font-weight:700>=</span> p_container
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic># Wire the per-user component into the owner context (user scope)</span>
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>var</span> contexts <span style=color:#ff7b72;font-weight:700>:=</span> composition_container<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_contexts</span>()
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>var</span> owner_context <span style=color:#ff7b72;font-weight:700>:=</span> contexts<span style=color:#ff7b72;font-weight:700>.</span>owner
</span></span><span style=display:flex><span>	owner_context<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>set_owner</span>(user)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic># Access states through the session</span>
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>var</span> states <span style=color:#ff7b72;font-weight:700>:=</span> composition_container<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>get_states</span>()
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>var</span> building_state <span style=color:#ff7b72;font-weight:700>:=</span> states<span style=color:#ff7b72;font-weight:700>.</span>building
</span></span><span style=display:flex><span>	<span style=color:#ff7b72>var</span> targeting_state <span style=color:#ff7b72;font-weight:700>:=</span> states<span style=color:#ff7b72;font-weight:700>.</span>targeting
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic># From here, BuildingState.get_owner() / GridTargetingState.get_owner_root()</span>
</span></span><span style=display:flex><span>	<span style=color:#8b949e;font-style:italic># will reflect the GBUser configured above.</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=testing-utilities>Testing Utilities</h2><p>Unit tests often construct an injector with:</p><div class=highlight><div style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#737679">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript data-lang=gdscript><span style=display:flex><span><span style=color:#ff7b72>var</span> injector <span style=color:#ff7b72;font-weight:700>:=</span> GBInjectorSystem<span style=color:#ff7b72;font-weight:700>.</span><span style=color:#d2a8ff;font-weight:700>create_with_injection</span>(container)
</span></span></code></pre></td></tr></table></div></div><p>Or use factory helpers (e.g., <code>GodotTestFactory</code> for core helpers or <code>EnvironmentTestFactory</code> / <code>PlaceableTestFactory</code> for plugin-aware environments) to streamline container + system creation and guarantee a fresh context for each test case.</p><hr><h2 id=when-not-to-use-injection>When Not To Use Injection</h2><ul><li>Extremely simple helper nodes that only need a single exported reference.</li><li>One-off editor tools where direct resource assignment is clearer.</li><li>Performance‑critical inner loops (avoid extra method indirection during hot path creation if profiling reveals overhead).</li></ul><hr><h2 id=best-practices>Best Practices</h2><ul><li>Keep <code>resolve_gb_dependencies</code> fast; perform heavy initialization lazily afterwards if needed.</li><li>Avoid storing the entire <a href=../api/GBCompositionContainer/>GBCompositionContainer</a> on every node—pull only what you need to reduce coupling.</li><li>Prefer using accessor methods (e.g., <code>get_targeting_state()</code>) instead of reaching deeply into nested resources.</li><li><strong>Validation happens automatically</strong> after injection—no manual validation calls needed.</li><li>Scope injection roots to smallest reasonable subtree in large worlds to reduce signal churn.</li></ul><hr><h2 id=related-api-pages>Related API Pages</h2><ul><li><a href=../api/GBInjectorSystem/>GBInjectorSystem</a></li><li><a href=../api/GBCompositionContainer/>GBCompositionContainer</a></li></ul><hr><h2 id=future-enhancements-planned--considerations>Future Enhancements (Planned / Considerations)</h2><ul><li>Automatic parameter type discovery for richer docs (parsing argument annotations in <code>resolve_gb_dependencies</code>).</li><li>Optional interface tagging (annotation or signal-based) to reduce reliance on method name convention.</li><li>Hot-reload re-injection hooks for editor tooling.</li></ul><p>If you have additional needs, open an issue or propose an extension in the contributor docs.</p></div></main><aside class=gb-toc><div class=gb-toc-title>On this page</div><nav id=TableOfContents><ul><li><a href=#automatic-validation>Automatic Validation</a><ul><li><a href=#before-manual-validation-required>Before (Manual Validation Required)</a></li><li><a href=#after-automatic-validation>After (Automatic Validation)</a></li><li><a href=#benefits>Benefits</a></li><li><a href=#automatic-validation-system>Automatic Validation System</a></li></ul></li><li><a href=#goals>Goals</a></li><li><a href=#optin-contract>Opt‑In Contract</a></li><li><a href=#gbcompositioncontainer-overview>GBCompositionContainer Overview</a><ul><li><a href=#why-a-resource>Why a Resource?</a></li><li><a href=#central-configuration-gbconfig>Central Configuration: GBConfig</a></li></ul></li><li><a href=#gbinjectorsystem-lifecycle>GBInjectorSystem Lifecycle</a></li><li><a href=#injection-scoping>Injection Scoping</a></li><li><a href=#metadata--idempotency>Metadata & Idempotency</a></li><li><a href=#logging--debug-levels>Logging & Debug Levels</a></li><li><a href=#validation-flow>Validation Flow</a></li><li><a href=#example-pattern>Example Pattern</a><ul><li><a href=#user--session-example-51-bridge>User & Session example (5.1 bridge)</a></li></ul></li><li><a href=#testing-utilities>Testing Utilities</a></li><li><a href=#when-not-to-use-injection>When Not To Use Injection</a></li><li><a href=#best-practices>Best Practices</a></li><li><a href=#related-api-pages>Related API Pages</a></li><li><a href=#future-enhancements-planned--considerations>Future Enhancements (Planned / Considerations)</a></li></ul></nav></aside><footer class=gb-footer><p>&copy; 2025 Chris Tutorials. All rights reserved.</p><p>Built with <a href=https://gohugo.io/ target=_blank>Hugo</a> and
<a href=https://godotengine.org/ target=_blank>Godot</a>.</p></footer></div></body></html>