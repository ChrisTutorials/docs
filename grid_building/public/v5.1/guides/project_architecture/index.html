<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Project Architecture | GridBuilding Plugin</title>
<meta name=description content="Project Architecture documentation for the Grid Building system"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><link rel=stylesheet href=/css/custom.css><meta name=generator content="Hugo 0.146.5"></head><body><div class=gb-layout><header class=gb-header><a href=/ class=gb-brand><i class="fas fa-cubes" style=color:var(--gb-primary)></i>
<span>GridBuilding Plugin</span></a><div class=gb-search><i class="fas fa-search"></i>
<input type=text placeholder="Search documentation..." aria-label=Search></div><nav class=gb-nav><a href=/ class=gb-nav-link>Home
</a><a href=/v6.0/overview/ class=gb-nav-link>Documentation
</a><a href=/v5.1/overview/ class=gb-nav-link>Grid Building Plugin Overview
</a><a href=/v6.0/api/ class=gb-nav-link>API Reference
</a><a href=/v5.1/guides/ class=gb-nav-link>Getting Started Guides
</a><a href=/v6.0/examples/ class=gb-nav-link>Examples
</a><a href=/v5.1/examples/ class=gb-nav-link>Code Examples
</a><a href=/community/ class=gb-nav-link>Community
</a><a href=/v5.1/architecture-diagrams/ class=gb-nav-link>Architecture Diagrams</a></nav></header><aside class=gb-sidebar><nav class=gb-sidebar-nav><div class=gb-sidebar-section><div class=gb-sidebar-title>V6.0s</div><a href=/v6.0/guides/6-0-readiness-status/ class=gb-sidebar-link>GridBuilding 6.0 Readiness Status
</a><a href=/v6.0/guides/getting_started/ class=gb-sidebar-link>Getting Started with GridBuilding
</a><a href=/v6.0/guides/mode-architecture/ class=gb-sidebar-link>GridBuilding 6.0 Mode Architecture
</a><a href=/v6.0/guides/gdscript-to-csharp-mapping/ class=gb-sidebar-link>GDScript to C# Migration Guide
</a><a href=/v6.0/guides/csharp_state_integration/ class=gb-sidebar-link>C# State Integration with Godot Frontend
</a><a href=/v6.0/guides/troubleshooting/ class=gb-sidebar-link>Troubleshooting Guide
</a><a href=/v6.0/examples/godot_integration_example/ class=gb-sidebar-link>Godot Integration Example
</a><a href=/gridbuilding/v6.0-public/guides/dependency-resolution/ class=gb-sidebar-link>Dependency Resolution in GridBuilding v6.0 (Godot)
</a><a href=/gridbuilding/v6.0-public/guides/userid-quickstart/ class=gb-sidebar-link>Quick Start: Game-Owned UserId & Multi-Owner Orchestrators
</a><a href=/gridbuilding/v6.0-public/guides/building-system-architecture/ class=gb-sidebar-link>BuildingSystem Architecture (Legacy Session Orchestrator)
</a><a href=/gridbuilding/v6.0-public/guides/multi-owner-orchestration-priorities/ class=gb-sidebar-link>Multi-Owner Orchestration Priorities (v6.0)
</a><a href=/gridbuilding/v6.0/guides/placement-system-architecture/ class=gb-sidebar-link>Placement System and Architecture in GridBuilding v6.0 (Godot)
</a><a href=/gridbuilding/v6.0-public/guides/manipulation-system-architecture/ class=gb-sidebar-link>ManipulationSystemNode Architecture (Session Orchestrator)
</a><a href=/v6.0/guides/service_based_architecture/ class=gb-sidebar-link>Service-Based Architecture
</a><a href=/gridbuilding/v6-0/api/ class=gb-sidebar-link>GridBuilding API Reference</a></div><div class=gb-sidebar-section><div class=gb-sidebar-title>Grid Building Plugin v5.1.0</div><a href=/v5.1/overview/ class=gb-sidebar-link>Grid Building Plugin Overview
</a><a href=/v5.1/guides/ class=gb-sidebar-link>Getting Started Guides
</a><a href=/v5.1/api/ class=gb-sidebar-link>C# API Reference
</a><a href=/v5.1/examples/ class=gb-sidebar-link>Code Examples
</a><a href=/v5.1/architecture-diagrams/ class=gb-sidebar-link>Architecture Diagrams
</a><a href=/v5.1/debugging/ class=gb-sidebar-link>Debug Tools
</a><a href=/v5.1/migration/ class=gb-sidebar-link>Migration Guide
</a><a href=/v5.1/testing/ class=gb-sidebar-link>Testing
</a><a href=/v5.1/validation/ class=gb-sidebar-link>Validation Tools</a></div><div class=gb-sidebar-section><div class=gb-sidebar-title>Grid Building Plugin v5.0.0</div><a href=/v5.0/api/ class=gb-sidebar-link>GDScript API Reference
</a><a href=/v5.0/overview/ class=gb-sidebar-link></a><a href=/v5.0/debugging/ class=gb-sidebar-link>Debug Tools
</a><a href=/v5.0/migration/ class=gb-sidebar-link>Migration Guide
</a><a href=/v5.0/guides/ class=gb-sidebar-link>Plugin Overview
</a><a href=/v5.0/testing/ class=gb-sidebar-link>Testing
</a><a href=/v5.0/validation/ class=gb-sidebar-link>Validation Tools</a></div></nav></aside><main class=gb-main><div class=gb-content><h1>Project Architecture</h1><hr><p>The plugin architecture is layered to keep systems modular and testable while supporting flexible game integration.</p><h2 id=layer-overview>Layer Overview</h2><table><thead><tr><th>Layer</th><th>Contents</th><th>Notes</th></tr></thead><tbody><tr><td>Resource Configuration</td><td><a href=../api/GBConfig/>GBConfig</a>, <a href=../api/GBSettings/>GBSettings</a>, <a href=../api/GBTemplates/>GBTemplates</a>, <a href=../api/GBMessages/>GBMessages</a>, rule resources</td><td>Editable in inspector; serialized with project</td></tr><tr><td>Composition & Injection</td><td><a href=../api/GBCompositionContainer/>GBCompositionContainer</a>, <a href=../api/GBInjectorSystem/>GBInjectorSystem</a></td><td>Provides dependency injection & lazy construction</td></tr><tr><td>Core Systems</td><td>Placement, Targeting, Building, Manipulation, Validation, Indicator</td><td>Each focuses on a single domain concern</td></tr><tr><td>State Containers</td><td><a href=../api/GBStates/>GBStates</a> (mode, targeting, building, manipulation)</td><td>Shared by injected nodes; supports multi-context</td></tr><tr><td>Contexts</td><td><a href=../api/GBContexts/>GBContexts</a> (placement, systems, owner, level)</td><td>Encapsulate environment dependencies</td></tr><tr><td>UI & Interaction</td><td>Action bar, selection lists, info displays</td><td>Driven by states & actions resources</td></tr><tr><td>Testing Utilities</td><td>Factories, reports, test setups</td><td>Facilitate GdUnit coverage & deterministic assertions</td></tr></tbody></table><h2 id=dependency-injection-model>Dependency Injection Model</h2><p>Instead of global singletons, systems resolve dependencies from the injected composition container. Benefits:</p><ul><li>Multitenancy (multiple players/levels)</li><li>Clear test seams (swap in a fresh container)</li><li>Lazy provisioning (logger/settings only built when required)</li></ul><p>Nodes opt‚Äëin via <code>resolve_gb_dependencies</code> pattern. See the <a href=/v5-0/guides/dependency_injection/>Dependency Injection</a> document.</p><h2 id=-gridtargetingstate-single-source-of-truth>üéØ GridTargetingState: Single Source of Truth</h2><p><strong>v5.1.0 Architectural Principle</strong>: <a href=../api/GridTargetingState/>GridTargetingState</a> is the authoritative, centralized source for what is actively targeted in the entire Grid Building System.</p><p><strong>What it manages:</strong></p><ul><li><strong>BUILD mode</strong>: The placement preview being positioned</li><li><strong>MOVE mode</strong>: The manipulation copy during object manipulation</li><li><strong>Normal gameplay</strong>: The node detected by TargetingShapeCast2D</li></ul><p><strong>Why this matters:</strong></p><ul><li><strong>Consistency</strong>: All systems query the same targeting source</li><li><strong>Sync issues eliminated</strong>: No more state divergence between different components</li><li><strong>Simpler integrations</strong>: Third-party systems can rely on a single API for targeting info</li><li><strong>Clear responsibilities</strong>: Other systems (ManipulationState, BuildingState) focus on their domains; targeting is GridTargetingState&rsquo;s job</li></ul><p><strong>v5.1.0 API Improvement</strong>: <a href=../api/ManipulationData/>ManipulationData</a> was refactored to support this principle:</p><ul><li>Renamed <code>target</code> ‚Üí <code>move_copy</code> to clearly distinguish the manipulation preview from GridTargetingState&rsquo;s target</li><li>Removed <code>ManipulationState.active_target_node</code> (redundant with GridTargetingState)</li><li>Added safe helper methods: <code>get_move_copy_root()</code> and <code>get_active_root()</code></li></ul><p>This eliminates semantic confusion and reinforces GridTargetingState as the single source of truth for targeting.</p><p>See <a href=../api/GridTargetingState/>GridTargetingState API</a> for detailed targeting methods, <a href=./grid_targeting/>Grid Targeting Guide</a> for architectural details, and <a href=./breaking-changes/#v510-breaking-changes---manipulationdata-api-improvements>Breaking Changes - v5.1.0</a> for migration guidance.</p><h2 id=how-the-systems-work-together>How the Systems Work Together</h2><p>Instead of a complex diagram, let&rsquo;s walk through how the Grid Building system works in simple steps:</p><h3 id=the-basic-flow><strong>The Basic Flow:</strong></h3><ol><li><strong>You pick something to build</strong>: Click a placeable in the UI</li><li><strong>BuildingSystem wakes up</strong>: <code>enter_build_mode()</code> gets called with your choice</li><li><strong>GridPositioner2D handles targeting</strong>: Processes mouse/keyboard input to track where you&rsquo;re pointing on the grid</li><li><strong>TargetingShapeCast2D detects collisions</strong>: Updates collision state based on GridPositioner2D position</li><li><strong>IndicatorManager provides live feedback</strong>: Sets up indicators that follow your cursor and show placement validity</li><li><strong>PlacementValidator checks rules</strong>: Runs tile-based rules as you move the cursor around</li><li><strong>IndicatorManager shows visual feedback</strong>: Colors/animations appear to show valid/invalid spots in real-time</li><li><strong>ManipulationSystem (optional)</strong>: If enabled, lets you move/rotate the preview before placing</li><li><strong>You confirm placement</strong>: <code>BuildingSystem.try_build()</code> runs full validation (including non-tile rules)</li><li><strong>Object gets created</strong>: If everything checks out, your building appears in the world as a PlaceableInstance</li><li><strong>ManipulationSystem (post-placement)</strong>: Now you can select, move, rotate, or delete the placed object</li></ol><h3 id=v500-architectural-improvements><strong>v5.0.0 Architectural Improvements:</strong></h3><p><strong>Clean System Boundaries:</strong></p><pre tabindex=0><code>GridPositioner2D          ‚Üê Pure input handling &amp; positioning
‚îú‚îÄ‚îÄ TargetingShapeCast2D  ‚Üê Dedicated collision detection  
‚îî‚îÄ‚îÄ ManipulationParent    ‚Üê Transform handling container
    ‚îú‚îÄ‚îÄ IndicatorManager  ‚Üê Visual feedback &amp; validation manager
    ‚îÇ   ‚îú‚îÄ‚îÄ RuleCheckIndicator ‚Üê Individual rule indicators
    ‚îÇ   ‚îî‚îÄ‚îÄ RuleCheckIndicator ‚Üê Individual rule indicators  
    ‚îî‚îÄ‚îÄ PreviewObject     ‚Üê Object being manipulated
</code></pre><p><strong>Benefits:</strong></p><ul><li><strong>Unit testable components</strong> - Each system tested in isolation</li><li><strong>Composable collision strategies</strong> - Swap targeting implementations</li><li><strong>Eliminated race conditions</strong> - No hidden coupling between systems</li><li><strong>Reliable test execution</strong> - Consistent behavior in all environments</li></ul><h3 id=key-points-to-remember><strong>Key Points to Remember:</strong></h3><ul><li><strong>BuildingSystem</strong> orchestrates the entire build workflow - from mode entry to final placement</li><li><strong>GridPositioner2D</strong> handles all input processing and grid coordinate conversion</li><li><strong>IndicatorManager</strong> manages the visual feedback system (creates and parents rule indicators)</li><li><strong>ManipulationParent</strong> serves as transform container for preview objects and indicators</li><li><strong>ManipulationSystem</strong> has two jobs: preview adjustment (if enabled) and post-placement editing</li><li><strong>Validation happens twice</strong>: quick tile rules during preview, full rule validation on confirmation</li><li><strong>Each component has a single responsibility</strong> but they work together seamlessly</li></ul><h2 id=key-data-flows>Key Data Flows</h2><ol><li><strong>UI Selection</strong> ‚Üí User selects placeable from UI ‚Üí <code>BuildingSystem.enter_build_mode(placeable)</code> is called</li><li><strong>Build Mode Initialization</strong>: <a href=../api/BuildingSystem/>BuildingSystem</a> prepares preview with selected placeable</li><li><strong>Input Processing</strong>: <a href=../api/GridPositioner2D/>GridPositioner2D</a> processes mouse/keyboard input and converts to grid coordinates</li><li><strong>Collision Detection</strong>: <a href=../api/TargetingShapeCast2D/>TargetingShapeCast2D</a> updates collision state based on positioner position</li><li><strong>Live Validation</strong>: <a href=../api/PlacementValidator/>PlacementValidator</a> runs tile rules, <a href=../api/IndicatorManager/>IndicatorManager</a> shows live feedback via rule indicators</li><li><strong>Preview Manipulation</strong>: If enabled in placeable settings, <a href=../api/ManipulationSystem/>ManipulationSystem</a> can move/rotate preview instances during placement</li><li><strong>Confirmation</strong>: User confirms placement, <code>BuildingSystem.try_build()</code> runs full rule validation (including non-tile rules)</li><li><strong>Instantiation</strong>: If valid, <a href=../api/BuildingSystem/>BuildingSystem</a> spawns <a href=../api/PlaceableInstance/>PlaceableInstance</a> with metadata for manipulation & save/load</li><li><strong>Post-Placement</strong>: <a href=../api/ManipulationSystem/>ManipulationSystem</a> handles move/rotate/delete operations on placed instances</li></ol><h2 id=save--load-considerations>Save / Load Considerations</h2><p><a href=../api/PlaceableInstance/>PlaceableInstance</a> holds references back to originating <a href=../api/Placeable/>Placeable</a> enabling reconstruction. Systems should avoid storing raw scene node references across sessions; rely on IDs or resource paths.</p><h2 id=logging--debug-controls>Logging & Debug Controls</h2><p><a href=../api/GBDebugSettings/>GBDebugSettings</a> gates verbosity. High verbosity surfaces:</p><ul><li>Injection operations</li><li>Indicator setup summaries</li><li>Rule validation traces (future extension)</li></ul><p>{/* Testing Strategy moved to internal/testing_strategy.md */}</p><h2 id=extensibility-guidelines>Extensibility Guidelines</h2><ul><li>Favor composition (create a new rule resource) over conditionals inside existing rules.</li><li>Keep resource scripts lean; complex logic belongs in systems.</li><li>Add new UI affordances by observing states rather than polling systems directly.</li></ul><h2 id=planned-evolutions>Planned Evolutions</h2><ul><li>Cross-context synchronization primitives (multiplayer scenarios).</li><li>Performance profiling hooks (duration_ms in reports).</li><li>Rule documentation tooling.</li></ul><hr><h3 id=core-architecture-references>Core Architecture References</h3><ul><li><a href=/v5-0/guides/context_and_state/>Context & State</a> ‚Äì Distinguishes long‚Äëlived context objects from frequently mutating state containers; essential for understanding rule evaluation purity.</li><li><a href=/v5-0/guides/placement_chain/>Placement Chain</a> ‚Äì End‚Äëto‚Äëend flow from input to instantiated object.</li><li><a href=/v5-0/guides/dependency_injection/>Dependency Injection</a> ‚Äì Container pattern enabling multi‚Äëtenant/testable setup.</li><li><a href=/v5-0/guides/placement_rules/>Placement Rules Pipeline</a> ‚Äì Validation composition & indicator generation.</li></ul><h3 id=high-level-system-architecture>High-Level System Architecture</h3><p><strong>Core Components:</strong></p><ul><li><strong>Configuration & Templates</strong>: GBConfig, GBTemplates, GBMessages</li><li><strong>Composition</strong>: GBCompositionContainer, GBInjectorSystem</li><li><strong>Core Systems</strong>: BuildingSystem, PlacementValidator, IndicatorManager, GridTargetingSystem, ManipulationSystem</li><li><strong>State Management</strong>: <a href=../api/ModeState/>ModeState</a>, <a href=../api/BuildingState/>BuildingState</a>, <a href=../api/ManipulationState/>ManipulationState</a>, <a href=../api/GridTargetingState/>GridTargetingState</a></li><li><strong>UI</strong>: Selection/Action UI</li></ul><p><strong>Data Flow:</strong></p><ul><li>UI ‚Üí BuildingSystem ‚Üí PlacementValidator ‚Üí IndicatorManager</li><li>GridPositioner2D ‚Üí TargetingShapeCast2D ‚Üí GridTargetingState</li><li>IndicatorManager ‚Üí ManipulationParent (parent/child relationship)</li><li>Configuration ‚Üí CompositionContainer ‚Üí InjectorSystem ‚Üí All Systems</li><li>State components manage respective system states (targeting, building, manipulation)</li><li>ManipulationSystem handles preview objects and post-placement instances</li></ul><p>Last updated: 2025-08-20</p></div></main><aside class=gb-toc><div class=gb-toc-title>On this page</div><nav id=TableOfContents><ul><li><a href=#layer-overview>Layer Overview</a></li><li><a href=#dependency-injection-model>Dependency Injection Model</a></li><li><a href=#-gridtargetingstate-single-source-of-truth>üéØ GridTargetingState: Single Source of Truth</a></li><li><a href=#how-the-systems-work-together>How the Systems Work Together</a><ul><li><a href=#the-basic-flow><strong>The Basic Flow:</strong></a></li><li><a href=#v500-architectural-improvements><strong>v5.0.0 Architectural Improvements:</strong></a></li><li><a href=#key-points-to-remember><strong>Key Points to Remember:</strong></a></li></ul></li><li><a href=#key-data-flows>Key Data Flows</a></li><li><a href=#save--load-considerations>Save / Load Considerations</a></li><li><a href=#logging--debug-controls>Logging & Debug Controls</a></li><li><a href=#extensibility-guidelines>Extensibility Guidelines</a></li><li><a href=#planned-evolutions>Planned Evolutions</a><ul><li><a href=#core-architecture-references>Core Architecture References</a></li><li><a href=#high-level-system-architecture>High-Level System Architecture</a></li></ul></li></ul></nav></aside><footer class=gb-footer><p>&copy; 2025 Chris Tutorials. All rights reserved.</p><p>Built with <a href=https://gohugo.io/ target=_blank>Hugo</a> and
<a href=https://godotengine.org/ target=_blank>Godot</a>.</p></footer></div></body></html>